<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
<title>GAME</title>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
<!-- 以上 3 个 meta 标签 *必须* 放在 head 的最前面；其他任何的 head 内容必须在这些标签的 *后面* -->
<meta name="keywords" content="TODO">
<meta name="description" content="TODO">
<meta name="author" content="author,email address">
<!--定义网页搜索引擎索引方式，robotterms 是一组使用英文逗号「,」分割的值，通常有如下几种取值：none,noindex,nofollow,all,index和follow-->
<meta name="robots" content="index">
<!--favicon 图标-->
<link rel="icon" sizes="64x64" href="icon/64.png" type="image/png"/>

<!--Google Android原生浏览器-->
<!-- 定义你的网页为 Web 应用，添加到主屏  -->
<meta name="mobile-web-app-capable" content="yes"/>

<!--Apple iOS原生浏览器-->
<!--启用 WebApp 全屏模式-->
<meta name="apple-mobile-web-app-capable" content="yes">
<!--状态栏透明-->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<!--APP在主屏上显示的名字-->
<meta name="apple-mobile-web-app-title" content="TODO title">
<!--App在主屏上显示的图标-->
<link rel="apple-touch-icon" sizes="128x128" href="icon/128.png">

<!--QQ 浏览器（X5 内核）同样适用于微信，QQ等第三方应用页面开发 -->
<!-- 设置锁定横屏、竖屏显示模式，portrait（竖屏）， landscape（横屏）-->
<meta name="x5-orientation" content="portrait">
<!-- 设置全屏显示页面 -->
<meta name="x5-fullscreen" content="true">
<!-- 开启页面以应用模式显示（全屏显示等） -->
<meta name="x5-page-mode" content="app">

<!--UC 浏览器 -->
<!--portrait 为竖屏， landscape 为横屏 -->
<meta name="screen-orientation" content="portrait">
<!--设置全屏 -->
<meta name="full-screen" content="yes">
<!--开启应用模式 -->
<meta name="browsermode" content="application">
<!--缩放字体 -->
<meta name="wap-font-scale" content="no">

<!--360浏览器 -->
<!--设置 360 浏览器渲染模式：webkit 为极速内核，ie-comp 为 IE 兼容内核，ie-stand 为 IE 标准内核-->
<meta name="renderer" content="webkit">

<!--百度禁止转码-->
<meta http-equiv="Cache-Control" content="no-siteapp" />
<style>
	#rcmj_loading_log {
		width: 100%;
		height: 100%;
		display: flex;
		justify-content: center;
		align-items: center;
		position: absolute;
		z-index: 9998;
		background-image: url(../../../app/res/image1/haohaiLogin.jpg);
		background-position: center;
		background-repeat: no-repeat;
		background-size: cover;
	}
</style>

<script type="text/javascript">

	var winit = {};
	(function(){
		winit.win = {};
		winit.startTime = Date.now();
		var k;
		for(k in window){
			if(window.hasOwnProperty(k))
				winit.win[k] = 1;
		}
		var name = "chat"; // 每个项目需要定义自己的名称，该名称决定了访问域名和本地存储名
		var main = document.domain.replace(/^(\D+\w*\.)(\w+\.[\w\.]+)/,"$2");
		// var remote = (document.domain != main || /^\w+\.\w+$/.test(document.domain)) ? name +".":"";
		winit.store = name;
		winit.debug = false;
		// main = location.port ? main+":"+location.port:main;
		// winit.domains = [location.protocol+"//"+(remote ? "c"+remote:"")+main, location.protocol+"//"+remote+main];

		/**
		 * 判断是否在app内: 协议是file，而且在ios和android的webview运行
		 */
		var inApp = false;
		var inIOSApp = false;
		var inAndroidApp = false;

		if (location.protocol === "file:") {
			if (navigator.userAgent.indexOf('YINENG_ANDROID') >= 0) {
				winit.inAndroidApp = inAndroidApp = true;
			} else if (navigator.userAgent.indexOf('YINENG_IOS') >= 0) {
				winit.inIOSApp = inIOSApp = true;
			}
			winit.inApp = inApp = winit.inAndroidApp || winit.inIOSApp;
		}
		
		// winit.severIp = "192.168.31.226";  // 本地服务器
		winit.severIp = "39.98.200.23";  // 外网测试服
		winit.severPort = '80';

		var defaultDomains;
		var remoteDomains = ["http://" + winit.severIp + ":" + winit.severPort];
		// var remoteDomains = ["https://" + winit.severIp + ":" + winit.severPort];
		if (inApp) {
			winit.httpDomains = remoteDomains;

			if (inAndroidApp) {
				defaultDomains = winit.domains = ["file:///android_asset"];
			}
			if (inIOSApp) {
				var index = location.href.indexOf("/assets/");
				if (index < 0) throw new Error("iOS bundle has not find assets")
				index += "/assets".length;
				defaultDomains = winit.domains = [location.href.slice(0, index)];
			}
		} else {
			defaultDomains = winit.domains = remoteDomains;
		}

		// =======================更新相关==================
		// var jsInterceptID = 0;
		// var jsInterceptMap = {};
		// var jsInterceptUpdate = 100;
		// var jsInterceptUpdateMap = {};


		// window.handle_jsintercept_callback = function (listenerID, isSuccess, r1, r2, r3, r4, r5) {
		// 	if (listenerID in jsInterceptMap) {
		// 		var callback = jsInterceptMap[listenerID];
		// 		delete jsInterceptMap[listenerID];
		// 		callback && callback(isSuccess, r1, r2, r3, r4, r5);
		// 	}
		// }

		// window.handle_jsintercept_update = function (cbID, total, progress) {
		// 	if (cbID in jsInterceptUpdateMap) {
		// 		var update = jsInterceptUpdateMap[cbID];
		// 		update && update(total, progress);
		// 		//相等的时候自动移除对象
		// 		if (total === progress) {
		// 			delete jsInterceptUpdateMap[jsInterceptUpdate]
		// 		}
		// 	}
		// }


		// winit.JSIntercept = {
		// 	isNative: inApp,

		// 	// 告诉底层已经完成数据库更新，可以更新底层版本了
		// 	updateFinish: function (cb) {
		// 		jsInterceptMap[++jsInterceptID] = cb;
				
		// 		if (inAndroidApp) {
		// 			window.JSIntercept.updateFinish(jsInterceptID);
		// 		} else if (inIOSApp) {
		// 			window.webkit.messageHandlers.JSIntercept.postMessage(["updateFinish", jsInterceptID]);
		// 		} else {
		// 			setTimeout(cb, 0);
		// 		}
		// 	},

		// 	// 取App底层版本号
		// 	getAppVersion: function (cb) {

		// 		jsInterceptMap[++jsInterceptID] = cb;

		// 		if (inAndroidApp) {
		// 			window.JSIntercept.getAppVersion(jsInterceptID);
		// 		} else if (inIOSApp) {
		// 			window.webkit.messageHandlers.JSIntercept.postMessage(["getAppVersion", jsInterceptID]);
		// 		} else {
		// 			setTimeout(cb, 0);
		// 		}
		// 	},

		// 	// 更新App
		// 	// iOS：url用来跳转到下载页面
		// 	// Android：url用于底层更新apk文件
		// 	updateApp: function (url, cb, progress) {
		// 		jsInterceptMap[++jsInterceptID] = cb;
		// 		jsInterceptUpdateMap[jsInterceptUpdate] = progress;

		// 		if (inAndroidApp) {
		// 			window.JSIntercept.updateApp(jsInterceptUpdate, url, jsInterceptID);
		// 		} else if (inIOSApp) {
		// 			// TODO: 弹出safari浏览器，跳转到url，并退出程序
		// 			window.webkit.messageHandlers.JSIntercept.postMessage(["updateApp", jsInterceptUpdate, url, jsInterceptID]);
		// 		} else {
		// 			setTimeout(cb, 0);
		// 		}
		// 	},

		// 	getBootFile: function (fileName) {
		// 		return mobileBootFiles[fileName] && mobileBootFiles[fileName].content;
		// 	},

		// 	getMobileBootFiles: function (cb) {
		// 		jsInterceptMap[++jsInterceptID] = cb;

		// 		if (inAndroidApp) {
		// 			window.JSIntercept.getBootFiles(jsInterceptID);
		// 		} else if (inIOSApp) {
		// 			window.webkit.messageHandlers.JSIntercept.postMessage(["getBootFiles", jsInterceptID]);
		// 		} else {
		// 			setTimeout(cb, 0);
		// 		}
		// 	},

		// 	/*
		// 		* 如果path为"update.flag"，表示在getBootFiles里面设置清空标志
		// 		* content = "true"，表示正在更新
		// 		*/
		// 	saveFile: function (path, content, cb) {
		// 		jsInterceptMap[++jsInterceptID] = cb;

		// 		if (inAndroidApp) {
		// 			window.JSIntercept.saveFile(path, content, jsInterceptID);
		// 		} else if (inIOSApp) {
		// 			window.webkit.messageHandlers.JSIntercept.postMessage(["saveFile", path, content, jsInterceptID]);
		// 		} else {
		// 			setTimeout(cb, 0);
		// 		}
		// 	},

		// 	/**
		// 	 * 刷新页面
		// 	 */ 
		// 	restartApp: function () {
		// 		if (inAndroidApp) {
		// 			window.JSIntercept.restartApp();
		// 		} else if (inIOSApp) {
		// 			window.webkit.messageHandlers.JSIntercept.postMessage(["restartApp"]);
		// 		}
		// 	}
		// };
		// =======================更新结束==================

		var u8ArrayToStr = function (arr) {
			const decoder = new TextDecoder('utf-8');
			return decoder.decode(arr);
		}

		var base64ToU8Array = function (data) {
			var string = window.atob(data);
			var bytes = new Uint8Array(string.length);
			for (var i = 0; i < string.length; i++) {
				bytes[i] = string.charCodeAt(i);
			}
			return bytes;
		}

		winit.loadJS = function (roots, url, charset, callback, errText, i) {
			var u, n, head;
			if (Array.isArray(roots) && i >= roots.length) {
				return callback && callback(roots[0] + url, errText);
			}
			head = document.head || document.getElementsByTagName('head')[0] || document.documentElement;
			n = document.createElement('script');
			n.charset = charset;
			n.onerror = function () {
				if (!Array.isArray(roots)) {
					URL.revokeObjectURL(roots);
				}
				n.onload = n.onerror = undefined;
				head.removeChild(n);
				if (Array.isArray(roots)) {
					winit.loadJS(roots, url, charset, callback, errText, i === undefined ? 0 : i + 1);
				} else {
					return callback && callback(url, errText);
				}
			};
			n.onload = function () {
				if (!Array.isArray(roots)) {
					URL.revokeObjectURL(roots);
				}
				n.onload = n.onerror = undefined;
				head.removeChild(n);
				if (Array.isArray(roots)) {
					url = roots[i || 0] + url;
				}
				callback && callback(roots[i || 0] + url);
			};
			n.async = true;
			n.crossorigin = true;
			n.src = Array.isArray(roots) ? roots[i || 0] + url : roots;
			head.appendChild(n);
		};

		winit.initFail = function (url, err) { err ? alert(err +", " + url) : "";};
		winit.init = function (){};
		winit.flags = {};
		mobileBootFiles = {};
		winit.start = function () {
			if (winit.debug) {
				winit.loadJS(defaultDomains,
					"/wallet/chat/client/boot/hotfix.js", "utf8", winit.initFail, "load hotupdate error");
			}
			winit.loadJS(defaultDomains,
				"/wallet/chat/client/boot/index.js?" + Math.random(), "utf8", winit.initFail, "load index error");
		};


		if(document.hidden === true){
			setTimeout(function(){
				var div = document.createElement('div');
				div.onclick=function() {
					div.remove();
					winit.start();
				};
				div.setAttribute("style", "position:absolute;width: 100%;height: 100%;");
				div.innerHTML='<div style="position:absolute;width: 100%;top:50%;text-align:center;color:white;">页面暂停，按下可继续</div>';
				document.body.appendChild(div);
			}, 1);
		}else{
			winit.start();
		}
		
	})(); 
     
</script>
</head>
<body onselectstart="return false" style="-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);-webkit-user-select:none;background-color:#696969;margin:0px;padding:0px;list-style:none;overflow:hidden;">
	<div id="rcmj_loading_log" style="background-color:#fff">
		<div class="inner" id="logo_inner">
			<div class="logo animated  animated-hinge fadeIn">
			</div>
			<!-- 进度条 -->
			<div id="process-container">

			</div>
		</div>
	</div>
</body>
<script>
	/**
	 * 自适应
	 */
	 function browserAdaptive () {
		var cfg = {
			width: 750, height: 1334, wscale: 0, hscale: 0.25, full: false
		};
		const clientWidth = document.documentElement.clientWidth;
		const clientHeight = document.documentElement.clientHeight;
		var rootWidth = cfg.width;
		var rootHeight = cfg.height;
		var scaleW = clientWidth / rootWidth;
		var scaleH = clientHeight / rootHeight;
		if (cfg.wscale >= cfg.hscale) {
			// 宽度比例变动
			if (scaleW > scaleH * (cfg.wscale + 1)) {
				// 大于规定的比例
				rootWidth = rootWidth * (cfg.wscale + 1) | 0;
			} else {
				rootWidth = (clientWidth / scaleH) | 0;
			}
			scaleW = scaleH;
		} else {
			// 高度比例变动
			if (scaleH > scaleW * (cfg.hscale + 1)) {
				rootHeight = rootHeight * (cfg.hscale + 1) | 0;
			} else {
				rootHeight = (clientHeight / scaleW) | 0;
			}
			scaleH = scaleW;
		}
		const rootX = (clientWidth - rootWidth) / 2;
		const rootY = (clientHeight - rootHeight) / 2;
	
		// tslint:disable-next-line:max-line-length
		return `left:${rootX}px;top: ${rootY}px;width:${rootWidth}px;height:${rootHeight}px;-webkit-transform:scale(${scaleW},${scaleH});-moz-transform:scale(${scaleW},${scaleH});-ms-transform:scale(${scaleW},${scaleH});transform:scale(${scaleW},${scaleH});`;
	};
	
	document.querySelector('#rcmj_loading_log').setAttribute('style',browserAdaptive());
</script>
</html>
